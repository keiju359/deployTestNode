#!/usr/bin/env node

var sshconf = require('../index');
var argv = require('optimist').argv;

var path = argv.p || argv.path;

if (path) {
  sshconf.path(path);
}

sshconf.read(function(err, allhosts) {

  var host = argv.h || argv.host;
  var val = argv.v || argv.value;
  var remove = argv.r || argv.remove;
  var key = argv.k || argv.key;
  var keyval = key && val;

  if (host && keyval) {

    sshconf.value(host, key, val);
    sshconf.write(function(err) {
      if (err) {
        console.log(err);
      }
      else {
        console.log('Wrote the value `' + val + '` to the `' + 
          key + '` for the host named `' + host + '`');
      }
    });
  }
  else if (host && val) {

    console.log(sshconf.value(host, val));
  }
  else if (host && remove && val) {

    sshconf.remove(host, val);
    sshconf.write(function(err) {
      if (err) {
        console.log(err);
      }
      else {
        console.log('Removed the value `' + val + '` to the `' + 
          key + '` for the host named `' + host + '`');
      }
    });
  }
  else if (host && remove) {

    sshconf.remove(host);
    sshconf.write(function(err) {
      if (err) {
        console.log(err);
      }
      else {
        console.log('Removed the host named `' + host + '`');
      }
    });

  }
  else if (host) {

    console.log(sshconf.value(host));
  }
  else {

    console.log(sshconf.value());
  }
});

